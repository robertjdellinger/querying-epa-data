"0",""
"0","# Set your API key"
"0","# api_key <- ""YOUR_API_KEY_HERE"""
"0",""
"0","# API base URLs"
"0","apiUrlBase <- ""https://api.epa.gov/easey"""
"0","bucketUrlBase <- ""https://api.epa.gov/easey/bulk-files/"""
"0","servicesUrl <- paste0(apiUrlBase, ""/camd-services/bulk-files?API_KEY="", api_key)"
"0",""
"0","# GET request to fetch bulk file metadata"
"0","res <- GET(servicesUrl)"
"0","if (res$status_code > 399) {"
"0","  errorFrame <- fromJSON(rawToChar(res$content))"
"0","  stop(paste(""Error Code:"", errorFrame$error$code, errorFrame$error$message))"
"0","}"
"0",""
"0","# Parse the JSON response and format lastUpdated"
"0","bulkFiles <- fromJSON(rawToChar(res$content))"
"0","bulkFiles$lastUpdated <- strftime(bulkFiles$lastUpdated, ""%Y-%m-%dT%H:%M:%S"")"
"0",""
"0","# Print available file types"
"0","print(unique(bulkFiles$metadata$dataType))"
"1","[1]"
"1"," ""EDR""                                    "
"1"," ""Allowance""                              "
"1","
"
"1","[3]"
"1"," ""Mercury and Air Toxics Emissions (MATS)"""
"1"," ""Compliance""                             "
"1","
"
"1","[5]"
"1"," ""XML""                                    "
"1"," ""Emissions""                              "
"1","
"
"1","[7]"
"1"," ""Facility""                               "
"1","
"
"0","# Filter for Allowance Holdings files"
"0","accountFiles <- bulkFiles[bulkFiles$metadata$dataType == ""Allowance"", ]"
"0",""
"0","# Summary messages"
"0","message(""Number of Allowance Holdings files to download: "", nrow(newAccountFiles))"
"2","Number of Allowance Holdings files to download: 9
"
"0","message(""Total size of Allowance Holdings files: "", sum(newAccountFiles$megaBytes, na.rm = TRUE), "" MB"")"
"2","Total size of Allowance Holdings files: 62.4 MB
"
"0","# Set download directory"
"0","downloadDir <- here(""Data"", ""Raw"", ""EPA_CAMD_Allowance_Holdings"")"
"0","if (!dir.exists(downloadDir)) dir.create(downloadDir, recursive = TRUE)"
"0",""
"0","# Initialize an empty data table"
"0","accountDataBulk <- data.table()"
"0",""
"0","# Loop through each new file"
"0","if (nrow(newAccountFiles) > 0) {"
"0","  for (i in 1:nrow(newAccountFiles)) {"
"0","    s3Path <- newAccountFiles[i, ""s3Path""]"
"0","    filename <- newAccountFiles[i, ""filename""]"
"0","    fileURL <- paste0(bucketUrlBase, s3Path)"
"0","    "
"0","    message(""Downloading file: "", filename, "" from URL: "", fileURL)"
"0","    "
"0","    # Optionally save to disk:"
"0","    # GET(fileURL, write_disk(file.path(downloadDir, filename), overwrite = TRUE))"
"0","    "
"0","    # Read data directly into R and clean column names"
"0","    tempData <- fread(fileURL, showProgress = TRUE)"
"0","    tempData <- clean_names(tempData)"
"0","    "
"0","    accountDataBulk <- rbind(accountDataBulk, tempData, fill = TRUE)"
"0","  }"
"0","  # Optionally sort by year if the column exists"
"0","  if (""year"" %in% names(accountDataBulk)) {"
"0","    accountDataBulk <- accountDataBulk %>% arrange(year)"
"0","  }"
"0","}"
"2","Downloading file: holdings-csosg2.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-csosg2.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-csosg2.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 4822158 bytes (4.6 MB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 4.6 MB

"
"2","Downloading file: holdings-csosg3.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-csosg3.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-csosg3.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 1131537 bytes (1.1 MB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 1.1 MB

"
"2","Downloading file: holdings-csosg1.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-csosg1.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-csosg1.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 331994 bytes (324 KB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 324 KB

"
"2","Downloading file: holdings-csosg2e.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-csosg2e.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-csosg2e.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 595762 bytes (581 KB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 581 KB

"
"2","Downloading file: holdings-csso2g2.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-csso2g2.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-csso2g2.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 1340148 bytes (1.3 MB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 1.3 MB

"
"2","Downloading file: holdings-arp.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-arp.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-arp.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 44381495 bytes (42.3 MB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 42.3 MB

"
"2","Downloading file: holdings-csnox.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-csnox.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-csnox.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 7965395 bytes (7.6 MB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 7.6 MB

"
"2","Downloading file: holdings-csso2g1.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-csso2g1.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-csso2g1.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 4724952 bytes (4.5 MB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 4.5 MB

"
"2","Downloading file: holdings-txso2.csv from URL: https://api.epa.gov/easey/bulk-files/allowance/holdings-txso2.csv
"
"2","trying URL 'https://api.epa.gov/easey/bulk-files/allowance/holdings-txso2.csv'
"
"2","Content type 'application/octet-stream'"
"2"," length 61590 bytes (60 KB)
"
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","="
"2","
"
"2","downloaded 60 KB

"
"0","print(accountDataBulk)"
